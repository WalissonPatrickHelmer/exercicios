<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Gamificado de Python</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Fundo preto/escuro */
        }
        .code-block {
            background-color: #2d3748; /* Tom mais escuro para o bloco de c√≥digo */
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            margin-top: 1rem;
            overflow-x: auto;
            font-size: 0.875rem; /* text-sm */
        }
        .option-button:disabled {
            cursor: default;
            opacity: 0.7;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="quiz-container" class="bg-gray-800 rounded-xl shadow-lg p-6 max-w-2xl w-full">
        <h1 class="text-3xl font-bold mb-6 text-center text-blue-400">üêç Python Quiz - O Desafio das Vidas</h1>
        <div id="quiz-content"></div>
        <div id="feedback-container" class="mt-4 p-4 rounded-lg text-white font-medium text-center hidden"></div>
    </div>

    <script>
        const MAX_LIVES = 3;
        let LIVES = MAX_LIVES;
        let currentLevel = 1;
        let totalQuestions = 10;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let quizState = 'setup'; // 'setup', 'active', 'review', 'results', 'gameover'
        let isHintUsed = false;
        let isAnswerUsed = false;

        const quizContent = document.getElementById('quiz-content');
        const feedbackContainer = document.getElementById('feedback-container');

        // --- Dados do Quiz ---
        const ALL_QUIZ_DATA = {
            1: [
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo, considerando a concatena√ß√£o de strings?\n\n`x = \"5\"`\n`y = 2`\n`print(x * y)`", "options": ["7", "10", "55", "Erro de tipo"], "answer": "55", "rationale": "A multiplica√ß√£o de uma string por um n√∫mero inteiro resulta na repeti√ß√£o da string. "},
                {"question": "Qual ser√° o valor de `resultado` ap√≥s a execu√ß√£o deste c√≥digo?\n\n`a = 10`\n`b = 3`\n`resultado = a % b`", "options": ["3.33", "3", "1", "0"], "answer": "1", "rationale": "O operador de m√≥dulo (%) retorna o resto da divis√£o. $10 \\div 3 = 3$ com resto $1$. "},
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`texto = \"Python\"`\n`print(len(texto))`", "options": ["5", "6", "Python", "Erro"], "answer": "6", "rationale": "A fun√ß√£o `len()` retorna o n√∫mero de caracteres (comprimento) da string, que √© 6."},
                {"question": "Qual ser√° a sa√≠da do seguinte c√≥digo, considerando a indexa√ß√£o de listas?\n\n`minha_lista = [\"ma√ß√£\", \"banana\", \"laranja\"]`\n`print(minha_lista[1])`", "options": ["ma√ß√£", "banana", "laranja", "Erro"], "answer": "banana", "rationale": "A indexa√ß√£o de listas em Python come√ßa em 0. O √≠ndice 1 corresponde ao segundo elemento."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`if 5 > 3:`\n`  print(\"Sim\")`\n`else:`\n`  print(\"N√£o\")`", "options": ["Sim", "N√£o", "Erro", "5"], "answer": "Sim", "rationale": "A condi√ß√£o $5 > 3$ √© verdadeira, ent√£o o bloco de c√≥digo dentro do `if` √© executado."},
                {"question": "Qual m√©todo √© usado para adicionar um item ao final de uma lista em Python?", "options": ["insert()", "add()", "append()", "extend()"], "answer": "append()", "rationale": "O m√©todo `append()` √© o m√©todo padr√£o para adicionar um √∫nico item ao final de uma lista."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo, considerando a preced√™ncia de operadores?\n\n`print(4 + 2 * 3)`", "options": ["18", "10", "14", "24"], "answer": "10", "rationale": "A multiplica√ß√£o tem preced√™ncia sobre a adi√ß√£o. Primeiro calcula-se $2 \\times 3 = 6$, depois $4 + 6 = 10$. "},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`for i in range(3):`\n`  print(i)`", "options": ["1\n2\n3", "0\n1\n2", "0\n1\n2\n3", "3"], "answer": "0\n1\n2", "rationale": "A fun√ß√£o `range(3)` gera n√∫meros de $0$ at√© $3$, excluindo o $3$. "},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`minha_tupla = (1, 2, 3)`\n`print(minha_tupla[0])`", "options": ["(1, 2, 3)", "1", "2", "Erro de tipo"], "answer": "1", "rationale": "Tuplas, assim como listas, usam indexa√ß√£o baseada em $0$ para acessar elementos."},
                {"question": "Qual ser√° o valor de `x` ap√≥s a execu√ß√£o deste c√≥digo?\n\n`x = 10`\n`x += 5`", "options": ["10", "5", "15", "Erro"], "answer": "15", "rationale": "O operador `+=` √© um atalho para $x = x + 5$. "}
            ],
            2: [
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`print(f\"O valor √©: {2 * 5}\")`", "options": ["O valor √©: {2 * 5}", "O valor √©: 2 * 5", "O valor √©: 10", "Erro"], "answer": "O valor √©: 10", "rationale": "As f-strings (strings formatadas) em Python avaliam express√µes dentro das chaves `{}` e substituem o resultado na string, gerando 'O valor √©: 10'."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`s = \"Python\"`\n`print(s[2:5])`", "options": ["thon", "tho", "Pytho", "Python"], "answer": "tho", "rationale": "Em Python, o fatiamento de strings `[in√≠cio:fim]` inclui o √≠ndice inicial e vai at√©, mas n√£o inclui, o √≠ndice final. Portanto, `s[2:5]` pega os caracteres nos √≠ndices 2, 3 e 4, que s√£o 't', 'h' e 'o'."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo?\n\n`x = 5`\n`y = 10`\n`z = 15`\n`print(x < y and y > z)`", "options": ["True", "False", "Erro", "10"], "answer": "False", "rationale": "A primeira condi√ß√£o (`x < y`) √© verdadeira. No entanto, a segunda (`y > z`) √© falsa. Como o operador `and` exige que ambas as condi√ß√µes sejam verdadeiras, o resultado da express√£o √© `False`."},
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`lista_aninhada = [[1, 2], [3, 4]]`\n`print(lista_aninhada[1][0])`", "options": ["1", "2", "3", "[3, 4]"], "answer": "3", "rationale": "A nota√ß√£o `[1]` seleciona o segundo item da lista principal, que √© a lista `[3, 4]`. Em seguida, a nota√ß√£o `[0]` seleciona o primeiro item dessa lista, que √© `3`."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`for i in range(5):`\n`  if i == 3:`\n`    break`\n`  print(i)`", "options": ["0\n1\n2\n3", "0\n1\n2", "0\n1\n2\n3\n4", "3"], "answer": "0\n1\n2", "rationale": "O loop come√ßa em 0 e imprime 0, 1 e 2. Quando `i` se torna 3, a instru√ß√£o `if i == 3` √© verdadeira e o `break` √© executado, terminando o loop imediatamente."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`meu_dicionario = {'a': 1, 'b': 2}`\n`print('c' in meu_dicionario)`", "options": ["True", "False", "Erro", "1"], "answer": "False", "rationale": "O operador `in` verifica se uma chave espec√≠fica existe em um dicion√°rio. Como `'c'` n√£o √© uma chave em `meu_dicionario`, a express√£o retorna `False`."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo, considerando o escopo de vari√°veis?\n\n`x = 10`\n`def minha_funcao():`\n`  x = 5`\n`minha_funcao()`\n`print(x)`", "options": ["5", "10", "Erro", "None"], "answer": "10", "rationale": "A vari√°vel `x` dentro de `minha_funcao` √© local ao escopo da fun√ß√£o e n√£o afeta a vari√°vel global `x`. A fun√ß√£o √© chamada, mas a vari√°vel global `x` mant√©m seu valor original de 10."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo?\n\n`lista = [1, 2, 3]`\n`[elemento * 2 for elemento in lista]`\n`print(lista)`", "options": ["[2, 4, 6]", "[1, 2, 3]", "Erro", "Nenhum valor"], "answer": "[1, 2, 3]", "rationale": "A compreens√£o de lista cria uma nova lista, mas o resultado n√£o √© armazenado em uma vari√°vel. A lista original `lista` n√£o √© modificada."},
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`try:`\n`  resultado = 10 / 0`\n`except ZeroDivisionError:`\n`  print(\"Erro!\")`\n`finally:`\n`  print(\"Finalizado\")`", "options": ["Erro!", "Finalizado", "Erro!\nFinalizado", "Erro de divis√£o por zero"], "answer": "Erro!\nFinalizado", "rationale": "O bloco `try` falha, o `except` √© acionado e imprime 'Erro!', e o `finally` √© sempre executado, imprimindo 'Finalizado'."},
                {"question": "Qual dos seguintes m√©todos remove um item pelo seu *valor* em uma lista?", "options": ["pop()", "remove()", "del()", "clear()"], "answer": "remove()", "rationale": "O m√©todo `remove()` recebe o valor do item como argumento e remove a primeira ocorr√™ncia desse valor. O `pop()` remove pelo √≠ndice."}
            ],
            3: [
                {"question": "Qual √© a sa√≠da do c√≥digo a seguir?\n\n`def outer(a):\n  def inner(b):\n    return a + b\n  return inner\n\nf = outer(10)\nprint(f(5))`", "options": ["15", "10", "5", "Erro"], "answer": "15", "rationale": "Este √© um exemplo de *closure*. `outer(10)` retorna a fun√ß√£o `inner`, que 'lembra' do valor de `a=10`. Depois, `f(5)` executa `inner(5)`, retornando $10 + 5 = 15$. "},
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`lista = [1, 2, 3]`\n`lista_copy = lista[:]\nlista_copy[0] = 99\nprint(lista[0])`", "options": ["99", "1", "Erro", "None"], "answer": "1", "rationale": "O fatiamento `[:]` cria uma c√≥pia superficial da lista. Modificar `lista_copy` n√£o afeta a `lista` original."},
                {"question": "Qual ser√° a sa√≠da do seguinte c√≥digo?\n\n`def dobro(x): return x * 2`\n`numeros = [1, 2, 3]`\n`resultado = list(map(dobro, numeros))`\n`print(resultado)`", "options": ["<map object>", "[1, 4, 9]", "[2, 4, 6]", "Erro"], "answer": "[2, 4, 6]", "rationale": "A fun√ß√£o `map()` aplica a fun√ß√£o `dobro` a cada elemento da lista `numeros`, e `list()` converte o resultado em uma lista: $[1 \\times 2, 2 \\times 2, 3 \\times 2]$. "},
                {"question": "O que acontece se voc√™ tentar modificar uma tupla?\n\n`t = (1, 2, 3)`\n`t[0] = 4`", "options": ["O valor de $t$ muda para $(4, 2, 3)$", "Ocorre um `TypeError` (Erro de Tipo)", "O valor de $t$ muda para $[4, 2, 3]$", "Nenhuma mudan√ßa"], "answer": "Ocorre um `TypeError` (Erro de Tipo)", "rationale": "Tuplas s√£o **imut√°veis**. Qualquer tentativa de modificar um de seus elementos resultar√° em um `TypeError`."},
                {"question": "O que ser√° impresso pelo c√≥digo a seguir?\n\n`x = 10`\n`del x`\n`print(x)`", "options": ["10", "None", "Erro de Nome (`NameError`)", "0"], "answer": "Erro de Nome (`NameError`)", "rationale": "A instru√ß√£o `del` remove a refer√™ncia da vari√°vel `x`. Tentar imprimir `x` depois disso resulta em um `NameError`."},
                {"question": "Qual √© a sa√≠da do c√≥digo?\n\n`def saudacao(nome, saud='Ol√°'):`\n`  print(f'{saud}, {nome}')`\n`saudacao('Jo√£o', saud='Oi')`", "options": ["Ol√°, Jo√£o", "Oi, Jo√£o", "Erro", "Ol√°, Oi"], "answer": "Oi, Jo√£o", "rationale": "O argumento de palavra-chave `saud='Oi'` sobrescreve o valor padr√£o definido na fun√ß√£o, resultando em 'Oi, Jo√£o'."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`d = {'a': 1, 'b': 2}`\n`d.update({'b': 5, 'c': 3})`\n`print(d['b'])`", "options": ["2", "5", "3", "Erro"], "answer": "5", "rationale": "O m√©todo `update()` √© usado para mesclar dicion√°rios. Se uma chave j√° existir ('b'), seu valor √© sobrescrito."},
                {"question": "O que ser√° impresso?\n\n`for i in range(1, 4):`\n`  if i == 2: continue`\n`  print(i)`", "options": ["1\n2\n3", "1\n3", "2\n3", "1\n2"], "answer": "1\n3", "rationale": "O `continue` ignora o restante do c√≥digo dentro do loop na itera√ß√£o atual, voltando para a pr√≥xima. Quando $i=2$, o `print(i)` √© ignorado."},
                {"question": "Qual √© a sa√≠da do c√≥digo?\n\n`lista = [1, 2, 3, 4, 5]`\n`print(lista[::-1])`", "options": ["[5, 4, 3, 2, 1]", "[1, 2, 3, 4, 5]", "Erro", "[5]"], "answer": "[5, 4, 3, 2, 1]", "rationale": "O fatiamento `[::-1]` usa um passo de $-1$, que √© um atalho comum para reverter a ordem dos elementos da lista."},
                {"question": "Qual √© a fun√ß√£o do decorador `@staticmethod` em Python?", "options": ["Permite que o m√©todo acesse a inst√¢ncia (`self`)", "Define um m√©todo que pertence √† classe, mas n√£o recebe nem a inst√¢ncia nem a classe como primeiro argumento", "Define um m√©todo que pode ser chamado apenas fora da classe", "Define um m√©todo que s√≥ pode ser acessado por subclasses"], "answer": "Define um m√©todo que pertence √† classe, mas n√£o recebe nem a inst√¢ncia nem a classe como primeiro argumento", "rationale": "M√©todos est√°ticos n√£o operam na inst√¢ncia (n√£o usam `self`) ou na classe (n√£o usam `cls`), funcionando como fun√ß√µes comuns agrupadas dentro da classe."},
                // Novas perguntas para o N√≠vel 3 (Adicionadas para evitar repeti√ß√£o)
                {"question": "Qual √© o principal objetivo da instru√ß√£o `yield` em uma fun√ß√£o Python?", "options": ["Retornar um valor e sair da fun√ß√£o permanentemente", "Pausar a execu√ß√£o da fun√ß√£o e retornar um valor, retomando de onde parou na pr√≥xima chamada", "Lan√ßar uma exce√ß√£o de forma controlada", "Definir uma fun√ß√£o ass√≠ncrona"], "answer": "Pausar a execu√ß√£o da fun√ß√£o e retornar um valor, retomando de onde parou na pr√≥xima chamada", "rationale": "O `yield` define um gerador, que √© um tipo de iterador que pausa e retoma o estado da fun√ß√£o."},
                {"question": "Qual √© a forma correta de usar uma *list comprehension* para obter apenas n√∫meros pares de uma lista?\n\n`numeros = [1, 2, 3, 4, 5, 6]`", "options": ["[x for x in numeros if x % 2 == 0]", "[x for x in numeros if x % 2]", "[x if x % 2 == 0 else None for x in numeros]", "[x for x in numeros where x % 2 == 0]"], "answer": "[x for x in numeros if x % 2 == 0]", "rationale": "A condi√ß√£o (`if x % 2 == 0`) deve vir ap√≥s o loop `for` em uma list comprehension de filtragem."},
                {"question": "O que o c√≥digo a seguir far√°?\n\n`with open('arquivo.txt', 'w') as f:`\n`  f.write('Teste')`", "options": ["Abrir para leitura ('r')", "Abrir para escrita ('w') e garantir que o arquivo seja fechado automaticamente", "Abrir para escrita ('w') e manter o arquivo aberto", "Lan√ßar um erro de permiss√£o"], "answer": "Abrir para escrita ('w') e garantir que o arquivo seja fechado automaticamente", "rationale": "O comando `with` usa um gerenciador de contexto que garante que o arquivo seja fechado corretamente, mesmo que ocorram erros."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo?\n\n`x = lambda a, b: a * b`\n`print(x(4, 5))`", "options": ["lambda a, b: a * b", "9", "20", "Erro"], "answer": "20", "rationale": "As fun√ß√µes lambda s√£o fun√ß√µes an√¥nimas de uma √∫nica express√£o. O c√≥digo executa $4 \\times 5 = 20$. "},
                {"question": "O que significa o acr√¥nimo **MRO** (Method Resolution Order) em Python, especialmente em heran√ßa m√∫ltipla?", "options": ["Modelo de Requisi√ß√£o de Objetos", "M√≥dulo de Recursos Organizados", "Ordem de Resolu√ß√£o de M√©todos", "Modelo de Registro de Opera√ß√µes"], "answer": "Ordem de Resolu√ß√£o de M√©todos", "rationale": "O MRO determina a ordem em que as classes base s√£o pesquisadas quando um m√©todo √© chamado, seguindo o algoritmo C3."},
                {"question": "Qual √© o nome do m√©todo especial usado para definir o que acontece quando voc√™ usa a fun√ß√£o `str()` ou `print()` em um objeto?", "options": ["__new__", "__repr__", "__call__", "__str__"], "answer": "__str__", "rationale": "O m√©todo `__str__` retorna uma representa√ß√£o 'informal' e leg√≠vel por humanos de um objeto, usada por `print()`."},
                {"question": "O que o seguinte c√≥digo ir√° imprimir?\n\n`set1 = {1, 2, 3}`\n`set2 = {3, 4, 5}`\n`print(set1.difference(set2))`", "options": ["{3}", "{1, 2, 3, 4, 5}", "{1, 2}", "{4, 5}"], "answer": "{1, 2}", "rationale": "O m√©todo `difference()` retorna os elementos que est√£o em `set1` mas *n√£o* est√£o em `set2`. O elemento '3' √© comum e √© exclu√≠do."},
                {"question": "Qual instru√ß√£o deve ser usada dentro de uma fun√ß√£o para modificar uma vari√°vel que foi definida no escopo global?", "options": ["local", "return", "global", "pass"], "answer": "global", "rationale": "A palavra-chave `global` informa ao Python que a vari√°vel sendo modificada deve ser procurada e alterada no escopo global."},
                {"question": "Qual √© a sa√≠da do seguinte c√≥digo?\n\n`def f(x, y=[]):\n  y.append(x)\n  return y\n\nprint(f(1))\nprint(f(2))`", "options": ["[1]\n[2]", "[1]\n[1, 2]", "[1, 2]\n[1, 2]", "Erro"], "answer": "[1]\n[1, 2]", "rationale": "Listas s√£o argumentos padr√£o mut√°veis. A lista `y` √© criada apenas uma vez (na defini√ß√£o da fun√ß√£o), ent√£o chamadas subsequentes modificam a mesma lista. A primeira chamada retorna `[1]`, a segunda adiciona 2 a essa mesma lista, retornando `[1, 2]`."}
            ]
        };

        // --- Utilidades ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function renderLives() {
            // Usa √≠cones Unicode para representar as vidas, incluindo meia vida
            let hearts = '';
            const fullHearts = Math.floor(LIVES);
            const hasHalfHeart = LIVES % 1 !== 0;

            for (let i = 0; i < fullHearts; i++) {
                hearts += '‚ù§Ô∏è '; // Cora√ß√£o Cheio
            }
            if (hasHalfHeart) {
                hearts += 'üíî '; // Representa Meia Vida (Cora√ß√£o Quebrado)
            }
            // Adiciona cora√ß√µes vazios para mostrar o m√°ximo
            for (let i = 0; i < MAX_LIVES - Math.ceil(LIVES); i++) {
                 hearts += 'ü§ç '; // Cora√ß√£o Vazio
            }
            return `<span class="text-2xl">${hearts}</span>`;
        }


        // --- Renderiza√ß√£o Inicial (Setup) ---
        function displaySetup() {
            quizState = 'setup';
            LIVES = MAX_LIVES; // Reseta as vidas no in√≠cio
            score = 0;
            currentQuestionIndex = 0;

            const availableLevels = Object.keys(ALL_QUIZ_DATA).length;
            const levelNames = { 1: 'B√°sico (Iniciante)', 2: 'Intermedi√°rio (Estruturas)', 3: 'Avan√ßado (Fun√ß√µes/Classes)' };

            quizContent.innerHTML = `
                <div class="text-gray-100 text-center space-y-6 p-4">
                    <p class="text-xl font-semibold text-blue-300">Personalize seu Desafio</p>
                    <p class="text-sm text-yellow-400">üö® Voc√™ tem ${MAX_LIVES} vidas. Errou, perde 1. Zerou, Reinicia!</p>
                    
                    <div class="space-y-3 text-left">
                        <label for="level-select" class="block text-md font-medium text-gray-300">Escolha o N√≠vel:</label>
                        <select id="level-select" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            ${Array.from({ length: availableLevels }, (_, i) => i + 1).map(level => `
                                <option value="${level}" ${level === currentLevel ? 'selected' : ''}>N√≠vel ${level} - ${levelNames[level] || ''}</option>
                            `).join('')}
                        </select>
                    </div>

                    <div class="space-y-3 text-left">
                        <label for="quantity-select" class="block text-md font-medium text-gray-300">N√∫mero de Perguntas (M√°x. ${ALL_QUIZ_DATA[currentLevel].length}):</label>
                        <select id="quantity-select" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="5">5 Perguntas</option>
                            <option value="10" selected>10 Perguntas</option>
                            <option value="15">15 Perguntas</option>
                        </select>
                    </div>

                    <button id="start-button" class="w-full mt-8 px-6 py-3 bg-green-600 text-white font-semibold rounded-full shadow-md hover:bg-green-700 transition-colors duration-300 transform hover:scale-[1.02]">
                        Iniciar Desafio
                    </button>
                </div>
            `;
            document.getElementById('start-button').addEventListener('click', startQuiz);
            document.getElementById('level-select').addEventListener('change', updateMaxQuestions);
            feedbackContainer.classList.add('hidden');
        }

        // Fun√ß√£o para atualizar o n√∫mero m√°ximo de perguntas na tela de setup
        function updateMaxQuestions() {
            const level = parseInt(document.getElementById('level-select').value);
            const max = ALL_QUIZ_DATA[level]?.length || 0;
            const quantitySelect = document.getElementById('quantity-select');
            
            // Atualiza o label
            document.querySelector('label[for="quantity-select"]').textContent = `N√∫mero de Perguntas (M√°x. ${max}):`;

            // Garante que o valor selecionado n√£o exceda o m√°ximo
            if (parseInt(quantitySelect.value) > max) {
                quantitySelect.value = max;
            }
        }

        // --- In√≠cio do Quiz ---
        function startQuiz() {
            currentLevel = parseInt(document.getElementById('level-select').value);
            let requestedQuestions = parseInt(document.getElementById('quantity-select').value);
            
            const rawQuestions = ALL_QUIZ_DATA[currentLevel] || [];
            
            // Garante que n√£o pedimos mais perguntas do que existem (Corrigindo o bug de repeti√ß√£o)
            totalQuestions = Math.min(requestedQuestions, rawQuestions.length);

            // Embaralha e limita a quantidade, garantindo perguntas √∫nicas
            currentQuestions = shuffle([...rawQuestions]).slice(0, totalQuestions);

            if (currentQuestions.length === 0) {
                alert("Nenhuma pergunta dispon√≠vel para a sele√ß√£o. Por favor, tente outra.");
                return;
            }

            // Reseta o estado do jogo
            LIVES = MAX_LIVES;
            currentQuestionIndex = 0;
            score = 0;
            quizState = 'active';
            displayQuestion();
        }

        // --- Renderiza√ß√£o da Pergunta ---
        function displayQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                displayResults();
                return;
            }
            
            const q = currentQuestions[currentQuestionIndex];
            isHintUsed = false;
            isAnswerUsed = false;

            const parts = q.question.split('\n\n');
            const preQuestion = parts[0];
            const codeSnippetLines = parts.slice(1).join('\n');
            
            quizContent.innerHTML = `
                <div class="mb-4 flex justify-between items-center text-gray-400">
                    <span class="text-lg font-semibold">N√≠vel ${currentLevel}</span>
                    <span class="text-lg font-semibold">Pergunta ${currentQuestionIndex + 1}/${currentQuestions.length}</span>
                </div>
                
                <div id="lives-display" class="mb-4 text-center text-xl font-bold text-red-500">${renderLives()}</div>
                
                <p class="text-xl font-bold mb-4 text-gray-100">${preQuestion}</p>
                
                ${codeSnippetLines ? `<pre class="code-block">${codeSnippetLines}</pre>` : ''}
                
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                    ${shuffle([...q.options]).map(option => `
                        <button class="option-button w-full text-left p-4 bg-gray-700 text-gray-100 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200 shadow-md" data-answer="${option}">
                            ${option}
                        </button>
                    `).join('')}
                </div>
                
                <div id="help-buttons" class="mt-6 space-y-3">
                    <button id="hint-button" class="w-full px-6 py-3 bg-yellow-600 text-white font-semibold rounded-full shadow-md hover:bg-yellow-700 transition-colors duration-300">
                        Dica (Revela a explica√ß√£o)
                    </button>
                    <button id="reveal-answer-button" class="hidden w-full px-6 py-3 bg-red-800 text-white font-semibold rounded-full shadow-md hover:bg-red-900 transition-colors duration-300">
                        Revelar Resposta Certa
                    </button>
                </div>

                <div id="next-button-wrapper" class="mt-4"></div>
            `;
            
            document.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', handleAnswer);
            });
            document.getElementById('hint-button').addEventListener('click', handleHint);
            document.getElementById('reveal-answer-button').addEventListener('click', handleAnswerReveal);
            
            feedbackContainer.classList.add('hidden');
        }

        // --- L√≥gica de Dica ---
        function handleHint() {
            const q = currentQuestions[currentQuestionIndex];
            feedbackContainer.classList.remove('hidden', 'bg-red-600', 'bg-green-600');
            feedbackContainer.classList.add('bg-yellow-600');
            feedbackContainer.innerHTML = `<strong>Dica:</strong> ${q.rationale}`;
            
            isHintUsed = true;
            document.getElementById('hint-button').disabled = true;
            document.getElementById('reveal-answer-button').classList.remove('hidden');
        }

        // --- L√≥gica de Revelar Resposta Certa (Pular) ---
        function handleAnswerReveal() {
            const q = currentQuestions[currentQuestionIndex];
            
            isAnswerUsed = true; // Marca que a resposta foi revelada

            // Marca visualmente a resposta correta (em vermelho para indicar que n√£o houve acerto)
            document.querySelectorAll('.option-button').forEach(button => {
                button.disabled = true;
                if (button.dataset.answer === q.answer) {
                    button.classList.add('border-4', 'border-red-500', 'bg-red-700');
                }
            });

            // Feedback: N√£o pontua nem recupera vida
            feedbackContainer.classList.remove('hidden', 'bg-green-600', 'bg-yellow-600');
            feedbackContainer.classList.add('bg-red-600');
            feedbackContainer.innerHTML = `<strong>Resposta Revelada:</strong> ${q.answer}<br>Voc√™ usou a ajuda m√°xima. **N√£o houve pontua√ß√£o nem recupera√ß√£o de vida**.`;
            
            // Desabilita bot√µes de ajuda
            document.getElementById('hint-button').disabled = true;
            document.getElementById('reveal-answer-button').disabled = true;

            // Adiciona bot√£o Pr√≥xima Pergunta
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Pr√≥xima Pergunta';
            nextButton.className = 'w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-md hover:bg-blue-700 transition-colors duration-300';
            nextButton.addEventListener('click', () => {
                currentQuestionIndex++;
                quizState = 'active';
                displayQuestion();
            });
            document.getElementById('next-button-wrapper').appendChild(nextButton);
            
            // Garante que o estado n√£o mude com clique subsequente
            document.querySelectorAll('.option-button').forEach(button => button.removeEventListener('click', handleAnswer));
        }

        // --- L√≥gica de Resposta (Principal) ---
        function handleAnswer(event) {
            if (quizState !== 'active') return;
            quizState = 'review'; 
            
            // Desabilita bot√µes de ajuda
            document.getElementById('hint-button').disabled = true;
            document.getElementById('reveal-answer-button').disabled = true;

            const selectedAnswer = event.target.dataset.answer;
            const q = currentQuestions[currentQuestionIndex];
            const isCorrect = (selectedAnswer === q.answer);
            
            let lifeChange = 0;
            let scoreChange = 0;
            let feedbackText = '';

            if (isCorrect) {
                scoreChange = 1;
                event.target.classList.replace('bg-gray-700', 'bg-green-700');
                event.target.classList.replace('hover:bg-gray-600', 'hover:bg-green-700');

                if (isAnswerUsed) {
                    // Se a resposta foi revelada, n√£o deve entrar aqui, mas por seguran√ßa.
                    lifeChange = 0;
                    feedbackText = `<strong>Acerto for√ßado.</strong> Sem recupera√ß√£o de vida.`;
                } else if (isHintUsed) {
                    // Acerto com dica: +0.5 vida
                    lifeChange = 0.5;
                    feedbackText = `<strong>Correto! (+0.5 Vida)</strong><br>${q.rationale}`;
                } else {
                    // Acerto sem dica: +1 vida
                    lifeChange = 1;
                    feedbackText = `<strong>Correto! (+1 Vida)</strong><br>${q.rationale}`;
                }

                feedbackContainer.classList.remove('bg-red-600');
                feedbackContainer.classList.add('bg-green-600');
                
            } else {
                // Erro: -1 vida
                lifeChange = -1;
                feedbackText = `<strong>Incorreto! (-1 Vida)</strong> A resposta correta √© "${q.answer}".<br>${q.rationale}`;

                event.target.classList.replace('bg-gray-700', 'bg-red-700');
                event.target.classList.replace('hover:bg-gray-600', 'hover:bg-red-700');
                
                // Marca a resposta correta
                document.querySelectorAll('.option-button').forEach(button => {
                    if (button.dataset.answer === q.answer) {
                        button.classList.add('border-4', 'border-green-500');
                    }
                });
                feedbackContainer.classList.remove('bg-green-600');
                feedbackContainer.classList.add('bg-red-600');
            }
            
            // Aplica as mudan√ßas
            score += scoreChange;
            LIVES = Math.min(MAX_LIVES, Math.max(0, LIVES + lifeChange)); // Limita entre 0 e MAX_LIVES

            feedbackContainer.innerHTML = feedbackText;
            document.getElementById('lives-display').innerHTML = renderLives(); // Atualiza display

            // Check for Game Over
            if (LIVES <= 0) {
                feedbackContainer.classList.remove('hidden');
                setTimeout(displayGameOver, 1500); // D√° tempo para ver o feedback
                return;
            }

            feedbackContainer.classList.remove('hidden');

            // Desabilita bot√µes de op√ß√£o
            document.querySelectorAll('.option-button').forEach(button => button.disabled = true);

            // Adiciona bot√£o Pr√≥xima Pergunta
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Pr√≥xima Pergunta';
            nextButton.className = 'w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-md hover:bg-blue-700 transition-colors duration-300';
            nextButton.addEventListener('click', () => {
                currentQuestionIndex++;
                quizState = 'active';
                displayQuestion();
            });
            document.getElementById('next-button-wrapper').appendChild(nextButton);
        }

        // --- Tela de Game Over ---
        function displayGameOver() {
            quizState = 'gameover';
            quizContent.innerHTML = `
                <div class="text-center text-gray-100 p-4 space-y-6">
                    <h2 class="text-4xl font-extrabold text-red-500">FIM DE JOGO! üò≠</h2>
                    <p class="text-xl text-gray-300">Voc√™ perdeu todas as suas vidas.</p>
                    <div class="bg-gray-700 p-4 rounded-xl shadow-inner space-y-2">
                        <p class="text-lg font-medium text-gray-300">Pontua√ß√£o Final (at√© o Game Over):</p>
                        <p class="text-5xl font-extrabold text-red-400">${score} / ${currentQuestions.length}</p>
                    </div>
                    <p class="text-yellow-400">Tente novamente, concentre-se nas explica√ß√µes (Dicas)!</p>
                    <button id="restart-button-gameover" class="w-full mt-4 px-6 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition-colors duration-300 transform hover:scale-[1.02]">
                        Reiniciar (Voltar ao Setup)
                    </button>
                </div>
            `;
            document.getElementById('restart-button-gameover').addEventListener('click', resetSetup);
            feedbackContainer.classList.add('hidden');
        }


        // --- Tela de Resultados Finais ---
        function displayResults() {
            quizState = 'results';
            const total = currentQuestions.length;
            const percentage = ((score / total) * 100).toFixed(0);
            const isLastLevel = currentLevel >= Object.keys(ALL_QUIZ_DATA).length;
            const nextLevel = currentLevel + 1;

            quizContent.innerHTML = `
                <div class="text-center text-gray-100 p-4 space-y-6">
                    <h2 class="text-3xl font-extrabold text-blue-400">üèÜ Desafio Conclu√≠do!</h2>
                    
                    <div class="bg-gray-700 p-6 rounded-xl shadow-inner space-y-2">
                        <p class="text-lg font-medium text-gray-300">Seu Desempenho no N√≠vel ${currentLevel}</p>
                        <p class="text-5xl font-extrabold text-white">${score} / ${total}</p>
                        <p class="text-xl font-bold text-green-400">${percentage}% de acertos</p>
                        <p class="text-sm text-yellow-300 mt-2">Vidas restantes: ${LIVES} ${renderLives()}</p>
                    </div>

                    <p class="text-gray-300">${percentage >= 70 ? 'Parab√©ns! O seu desempenho foi excelente. Vamos aumentar o desafio?' : 'Voc√™ pode revisar os conceitos e tentar novamente antes de subir de n√≠vel.'}</p>

                    <div class="flex flex-col space-y-4 pt-4">
                        ${!isLastLevel ? `
                            <button id="continue-button" class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300 transform hover:scale-[1.02]">
                                Continuar (Subir para o N√≠vel ${nextLevel})
                            </button>
                        ` : `
                            <p class="text-yellow-400 font-semibold">ü•≥ Parab√©ns! Voc√™ concluiu todos os n√≠veis. Que tal reiniciar para dominar o conte√∫do?</p>
                        `}
                        <button id="restart-button" class="w-full px-6 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition-colors duration-300 transform hover:scale-[1.02]">
                            Reiniciar (Mudar Configura√ß√µes)
                        </button>
                    </div>
                </div>
            `;
            
            if (!isLastLevel) {
                document.getElementById('continue-button').addEventListener('click', startNextLevel);
            }
            document.getElementById('restart-button').addEventListener('click', resetSetup);

            feedbackContainer.classList.add('hidden');
        }

        // --- Fun√ß√µes de Controle ---
        function startNextLevel() {
            if (currentLevel < Object.keys(ALL_QUIZ_DATA).length) {
                currentLevel++;
                // Inicia o pr√≥ximo n√≠vel com a nova dificuldade
                document.getElementById('level-select').value = currentLevel; 
                startQuiz(); 
            }
        }
        
        function resetSetup() {
            currentLevel = 1; // Volta ao n√≠vel 1
            totalQuestions = 10; // Volta para 10 perguntas
            displaySetup();
        }

        // Inicia a aplica√ß√£o na tela de configura√ß√£o
        displaySetup();
    </script>
</body>
</html>
